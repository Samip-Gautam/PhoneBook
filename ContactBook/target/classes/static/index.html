<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contact Book</title>

    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
    >

    <style>
        body {
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 24px 28px;
            max-width: 800px;
            width: 100%;
            color: #fff;
        }

        h1 {
            font-weight: 700;
            margin-bottom: 1rem;
        }

        label {
            font-weight: 500;
        }

        .table-wrapper {
            background: rgba(255, 255, 255, 0.06);
            border-radius: 12px;
            padding: 12px;
            margin-top: 10px;
        }

        table {
            background-color: rgba(255, 255, 255, 0.9);
        }

        .table thead th {
            background-color: #0d6efd;
            color: #fff;
        }

        #message {
            color: #b7ffb1;
        }

        #error {
            color: #ffb3b3;
        }

        .btn-light-outline {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: #fff;
        }

        .btn-light-outline:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        input::placeholder {
            color: #aaa;
        }
    </style>
</head>
<body>
<div class="glass-card">
    <h1 class="text-center mb-4">Contact Book</h1>

    <!-- Add Contact Form -->
    <div class="mb-4">
        <h5 class="mb-3">Add Contact</h5>
        <div class="row g-2">
            <div class="col-md-5">
                <input id="name" class="form-control" placeholder="Name" />
            </div>
            <div class="col-md-5">
                <input id="number" class="form-control" placeholder="Number" />
            </div>
            <div class="col-md-2 d-grid">
                <button class="btn btn-success" onclick="saveContact()">Save</button>
            </div>
        </div>
        <div id="message" class="mt-2 small"></div>
        <div id="error" class="mt-1 small"></div>
    </div>

    <!-- Contacts Table -->
    <div>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">All Contacts</h5>
            <div>
                <button class="btn btn-light-outline btn-sm me-2" onclick="loadContacts()">Load</button>
                <button class="btn btn-danger btn-sm" onclick="deleteAll()">Delete All</button>
            </div>
        </div>

        <div class="table-wrapper">
            <table class="table table-sm table-hover mb-0">
                <thead>
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Number</th>
                </tr>
                </thead>
                <tbody id="contacts-body">
                <!-- rows will be injected here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    async function saveContact() {
        clearMessages();
        const name = document.getElementById('name').value.trim();
        const number = document.getElementById('number').value.trim();

        if (!name || !number) {
            document.getElementById('error').textContent = 'Name and number are required';
            return;
        }

        try {
            const response = await fetch('/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, number })
            });

            if (!response.ok) {
                const text = await response.text();
                throw new Error(text || 'Save failed');
            }

            const data = await response.json(); // save() returns PhoneEntity
            document.getElementById('message').textContent =
                'Saved contact with id ' + data.id;

            document.getElementById('name').value = '';
            document.getElementById('number').value = '';

            await loadContacts();
        } catch (e) {
            document.getElementById('error').textContent = e.message;
        }
    }

    async function loadContacts() {
        clearMessages();
        const tbody = document.getElementById('contacts-body');
        tbody.innerHTML = '';

        try {
            const response = await fetch('/viewall');
            if (!response.ok) {
                const text = await response.text();
                throw new Error(text || 'Failed to load contacts');
            }

            const data = await response.json();

            data.forEach(contact => {
                const tr = document.createElement('tr');

                const tdId = document.createElement('td');
                tdId.textContent = contact.id;
                tr.appendChild(tdId);

                const tdName = document.createElement('td');
                tdName.textContent = contact.name;
                tr.appendChild(tdName);

                const tdNumber = document.createElement('td');
                tdNumber.textContent = contact.number;
                tr.appendChild(tdNumber);

                tbody.appendChild(tr);
            });
        } catch (e) {
            document.getElementById('error').textContent = e.message;
        }
    }

    async function deleteAll() {
        clearMessages();
        try {
            const response = await fetch('/deleteAll', {
                method: 'DELETE'
            });
            if (!response.ok) {
                const text = await response.text();
                throw new Error(text || 'Delete all failed');
            }
            document.getElementById('message').textContent = 'All contacts deleted';
            document.getElementById('contacts-body').innerHTML = '';
        } catch (e) {
            document.getElementById('error').textContent = e.message;
        }
    }

    function clearMessages() {
        document.getElementById('message').textContent = '';
        document.getElementById('error').textContent = '';
    }

    // load once on page load
    loadContacts();
</script>
</body>
</html>
